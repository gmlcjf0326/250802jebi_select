<!DOCTYPE html>
<html lang="ko">
	<head>
		<meta charset="UTF-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
		<meta name="theme-color" content="#667eea" />
		<link rel="manifest" href="manifest.json" />
		<title>ì²­ë…„ë¶€ ì œë¹„ë½‘ê¸°</title>
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			body {
				font-family: "Noto Sans KR", sans-serif;
				background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
				min-height: 100vh;
				display: flex;
				align-items: center;
				justify-content: center;
				color: white;
				overflow: hidden;
				padding: 20px;
			}

			.main-container {
				width: 100%;
				max-width: 1800px;
				height: 90vh;
				display: flex;
				gap: 30px;
				align-items: stretch;
			}

			.left-section {
				flex: 1;
				background: rgba(255, 255, 255, 0.1);
				padding: 40px;
				border-radius: 30px;
				backdrop-filter: blur(10px);
				box-shadow: 0 25px 45px rgba(0, 0, 0, 0.2);
				display: flex;
				flex-direction: column;
				align-items: center;
			}

			.right-section {
				flex: 1;
				background: rgba(255, 255, 255, 0.95);
				padding: 50px;
				border-radius: 30px;
				box-shadow: 0 25px 45px rgba(0, 0, 0, 0.2);
				display: none;
				flex-direction: column;
				justify-content: center;
				color: #333;
			}

			.right-section.show {
				display: flex;
				animation: slideIn 0.5s ease-out;
			}

			@keyframes slideIn {
				from {
					transform: translateX(100px);
					opacity: 0;
				}
				to {
					transform: translateX(0);
					opacity: 1;
				}
			}

			h1 {
				font-size: 4em;
				margin-bottom: 40px;
				text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
				animation: glow 2s ease-in-out infinite alternate;
				text-align: center;
			}

			@keyframes glow {
				from {
					text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3), 0 0 10px #fff;
				}
				to {
					text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3), 0 0 20px #fff,
						0 0 30px #fff;
				}
			}

			.lottery-box {
				position: relative;
				width: 450px;
				height: 550px;
				background: linear-gradient(145deg, #f0f0f0, #e0e0e0);
				border-radius: 30px;
				box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
				overflow: hidden;
				margin-bottom: 40px;
			}

			.papers {
				position: absolute;
				width: 100%;
				height: 100%;
				display: flex;
				flex-wrap: wrap;
				align-items: center;
				justify-content: center;
				padding: 30px;
				gap: 15px;
			}

			.paper {
				width: 70px;
				height: 90px;
				background: white;
				border-radius: 8px;
				box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
				position: relative;
				cursor: pointer;
				transition: all 0.3s ease;
			}

			.paper::before {
				content: "?";
				position: absolute;
				top: 50%;
				left: 50%;
				transform: translate(-50%, -50%);
				font-size: 36px;
				color: #667eea;
				font-weight: bold;
			}

			.paper.shuffle {
				animation: shuffle 0.8s ease-in-out;
			}

			@keyframes shuffle {
				0% {
					transform: translateY(0) rotate(0deg) scale(1);
				}
				20% {
					transform: translateY(-50px) rotate(-25deg) scale(1.1);
				}
				40% {
					transform: translateY(40px) rotate(20deg) scale(0.95);
				}
				60% {
					transform: translateY(-30px) rotate(-15deg) scale(1.05);
				}
				80% {
					transform: translateY(20px) rotate(10deg) scale(0.98);
				}
				100% {
					transform: translateY(0) rotate(0deg) scale(1);
				}
			}

			.lottery-box.shaking {
				animation: boxShake 0.5s ease-in-out;
			}

			@keyframes boxShake {
				0%,
				100% {
					transform: rotate(0deg);
				}
				25% {
					transform: rotate(-2deg);
				}
				75% {
					transform: rotate(2deg);
				}
			}

			.btn-group {
				display: flex;
				gap: 30px;
				justify-content: center;
			}

			button {
				padding: 20px 60px;
				font-size: 1.8em;
				border: none;
				border-radius: 50px;
				background: linear-gradient(145deg, #ff6b6b, #ee5a24);
				color: white;
				cursor: pointer;
				transition: all 0.3s ease;
				box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
				font-weight: bold;
			}

			button:hover {
				transform: translateY(-3px);
				box-shadow: 0 12px 30px rgba(0, 0, 0, 0.4);
			}

			button:active {
				transform: translateY(0);
			}

			button:disabled {
				background: #666;
				cursor: not-allowed;
				transform: none;
			}

			.result {
				text-align: center;
			}

			.result h2 {
				color: #667eea;
				margin-bottom: 40px;
				font-size: 3.5em;
				font-weight: bold;
			}

			.result .person {
				font-size: 4.5em;
				font-weight: bold;
				color: #333;
				margin-bottom: 40px;
				text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.1);
				animation: bounce 0.5s ease-out;
			}

			@keyframes bounce {
				0% {
					transform: scale(0);
				}
				50% {
					transform: scale(1.1);
				}
				100% {
					transform: scale(1);
				}
			}

			.result .topic {
				font-size: 2.8em;
				color: #667eea;
				margin-bottom: 30px;
				font-weight: 600;
			}

			.result .question {
				font-size: 2.2em;
				background: #f8f9fa;
				padding: 40px;
				border-radius: 20px;
				line-height: 1.6;
				font-weight: 500;
				box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
			}

			.hand {
				position: absolute;
				bottom: -150px;
				right: 50%;
				transform: translateX(50%);
				font-size: 120px;
				transition: bottom 0.5s ease;
			}

			.hand.picking {
				bottom: 200px;
				animation: pick 1s ease-in-out;
			}

			@keyframes pick {
				0%,
				100% {
					transform: translateX(50%) rotate(0deg);
				}
				50% {
					transform: translateX(50%) rotate(-10deg);
				}
			}

			.selected-paper {
				position: absolute;
				top: 50%;
				left: 50%;
				transform: translate(-50%, -50%) scale(0);
				width: 140px;
				height: 180px;
				background: white;
				border-radius: 15px;
				box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
				z-index: 100;
				transition: transform 0.5s ease;
			}

			.selected-paper.show {
				transform: translate(-50%, -50%) scale(1.8);
			}

			.topic-preview {
				text-align: center;
				padding: 50px;
			}

			.topic-preview h2 {
				color: #667eea;
				font-size: 3em;
				margin-bottom: 40px;
			}

			.topic-list {
				display: flex;
				flex-direction: column;
				gap: 25px;
				font-size: 2em;
				color: #555;
			}

			.topic-item {
				padding: 20px;
				background: #f0f0f0;
				border-radius: 15px;
				transition: all 0.3s ease;
			}

			.topic-item.active {
				background: #667eea;
				color: white;
				transform: scale(1.05);
				box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
			}

			@keyframes fall {
				to {
					transform: translateY(100vh) rotate(360deg);
					opacity: 0;
				}
			}

			/* íƒœë¸”ë¦¿ */
			@media (max-width: 1200px) {
				.main-container {
					flex-direction: column;
					height: auto;
					gap: 20px;
				}

				h1 {
					font-size: 3em;
				}

				.lottery-box {
					width: 350px;
					height: 450px;
				}

				button {
					padding: 15px 40px;
					font-size: 1.4em;
				}
			}

			/* ëª¨ë°”ì¼ */
			@media (max-width: 768px) {
				body {
					padding: 10px;
				}

				.main-container {
					max-width: 100%;
					height: 100vh;
					gap: 15px;
					padding: 0;
				}

				.left-section {
					padding: 20px;
					border-radius: 20px;
					flex: none;
					height: auto;
				}

				.right-section {
					padding: 25px;
					border-radius: 20px;
					flex: none;
					height: auto;
					min-height: 300px;
					position: relative;
				}

				h1 {
					font-size: 2em;
					margin-bottom: 20px;
				}

				.lottery-box {
					width: 280px;
					height: 350px;
					margin-bottom: 25px;
				}

				.papers {
					padding: 20px;
					gap: 10px;
				}

				.paper {
					width: 50px;
					height: 65px;
				}

				.paper::before {
					font-size: 24px;
				}

				.btn-group {
					gap: 15px;
					flex-wrap: wrap;
				}

				button {
					padding: 15px 35px;
					font-size: 1.2em;
					border-radius: 30px;
					min-width: 120px;
					-webkit-tap-highlight-color: transparent;
					touch-action: manipulation;
				}

				.hand {
					font-size: 80px;
					bottom: -100px;
				}

				.hand.picking {
					bottom: 150px;
				}

				.selected-paper {
					width: 100px;
					height: 130px;
				}

				.selected-paper.show {
					transform: translate(-50%, -50%) scale(1.5);
				}

				.result h2 {
					font-size: 2.5em;
					margin-bottom: 25px;
				}

				.result .person {
					font-size: 3em;
					margin-bottom: 25px;
				}

				.result .question {
					font-size: 1.5em;
					padding: 25px;
					line-height: 1.5;
				}

				.topic-preview h2 {
					font-size: 2em;
					margin-bottom: 25px;
				}

				.topic-preview {
					padding: 20px;
				}

				.topic-list {
					font-size: 1.3em;
					gap: 15px;
				}

				.topic-item {
					padding: 15px;
				}

				.pick-count {
					position: absolute;
					top: 10px;
					right: 20px;
					font-size: 1em;
					color: #667eea;
					font-weight: bold;
				}
			}

			/* ì•„ì£¼ ì‘ì€ ëª¨ë°”ì¼ */
			@media (max-width: 400px) {
				h1 {
					font-size: 1.5em;
				}

				.lottery-box {
					width: 250px;
					height: 320px;
				}

				button {
					padding: 12px 25px;
					font-size: 1em;
				}

				.result .person {
					font-size: 2.5em;
				}

				.result .question {
					font-size: 1.2em;
					padding: 20px;
				}
			}

			/* ê°€ë¡œ ëª¨ë“œ */
			@media (orientation: landscape) and (max-height: 600px) {
				.main-container {
					flex-direction: row;
					height: 100vh;
				}

				.left-section, .right-section {
					flex: 1;
					height: 100%;
					overflow-y: auto;
				}

				h1 {
					font-size: 1.8em;
					margin-bottom: 15px;
				}

				.lottery-box {
					width: 240px;
					height: 280px;
					margin-bottom: 15px;
				}
			}

			/* iOS Safe Area */
			@supports (padding: max(0px)) {
				body {
					padding-left: max(10px, env(safe-area-inset-left));
					padding-right: max(10px, env(safe-area-inset-right));
					padding-bottom: max(10px, env(safe-area-inset-bottom));
				}
			}

			/* í„°ì¹˜ ë””ë°”ì´ìŠ¤ ìµœì í™” */
			@media (hover: none) and (pointer: coarse) {
				button {
					min-height: 44px;
					min-width: 44px;
				}

				.paper {
					cursor: default;
				}
			}

			.pick-count {
				position: absolute;
				top: 20px;
				right: 30px;
				font-size: 1.2em;
				color: #667eea;
				font-weight: bold;
			}
		</style>
	</head>
	<body>
		<div class="main-container">
			<div class="left-section">
				<h1>âœ¨ ì£¼ì œë³„ ì œë¹„ë½‘ê¸° âœ¨</h1>

				<div class="lottery-box">
					<div
						class="papers"
						id="papers">
						<!-- ì œë¹„ë“¤ì´ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
					</div>
					<div
						class="hand"
						id="hand">
						ğŸ¤š
					</div>
					<div
						class="selected-paper"
						id="selectedPaper"></div>
				</div>

				<div class="btn-group">
					<button
						id="shuffleBtn"
						onclick="shufflePapers()">
						ğŸ”„ ì„ê¸°
					</button>
					<button
						id="pickBtn"
						onclick="pickPaper()">
						ğŸ¯ ë½‘ê¸°
					</button>
				</div>
			</div>

			<div
				class="right-section"
				id="rightSection">
				<div
					class="pick-count"
					id="pickCount">
					ë‚¨ì€ ë½‘ê¸°: 5/5
				</div>
				<div
					class="topic-preview"
					id="topicPreview">
					<h2>ì˜¤ëŠ˜ì˜ ì£¼ì œ</h2>
					<div class="topic-list">
						<div class="topic-item">ğŸ™ ë´‰ì‚¬</div>
						<div class="topic-item">ğŸ’° ì¬ì •ê´€ë¦¬</div>
						<div class="topic-item">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ë‹¤ìë…€</div>
						<div class="topic-item">ğŸµ ëª©ì†Œë¦¬</div>
						<div class="topic-item">ğŸ˜Š ë°ì€ë¯¸ì†Œ</div>
					</div>
				</div>
				<div
					class="result"
					id="result"
					style="display: none">
					<h2>ì„ íƒëœ ì§ˆë¬¸</h2>
					<div class="person"></div>
					<div class="question"></div>
				</div>
			</div>
		</div>

		<script>
			// ë¯¸ë¦¬ ì •í•´ì§„ ë°ì´í„°
			const presetData = [
				{
					name: "ì´ì¤‘êµ¬ ì§‘ì‚¬",
					topic: "ë´‰ì‚¬",
					question: "ê¸°ë„ì›ì—ì„œ ë´‰ì‚¬í•  ë•Œ ì–´ë–¤ ë§ˆìŒìœ¼ë¡œ í•˜ëŠ”ì§€?",
				},
				{
					name: "ì´ì€ì˜ˆ ê¶Œì‚¬",
					topic: "ì¬ì •ê´€ë¦¬",
					question: "ëˆì˜ ìœ í˜¹ì„ ì´ê²¨ë‚´ëŠ” ë°©ë²•ê³¼ ì¬ì •ê´€ë¦¬",
				},
				{
					name: "ì„ì„ ì˜ ê¶Œì‚¬",
					topic: "ë‹¤ìë…€",
					question: "ë‹¤ìë…€ í•˜ë‚˜ë‹˜ ë§ì”€ì— ìˆœì¢…í•œ ê²ƒì¸ì§€..?",
				},
				{
					name: "ë°•ì„±ë¶„ ì§‘ì‚¬",
					topic: "ëª©ì†Œë¦¬",
					question: "ê¾€ê¼¬ë¦¬ê°™ì€ ëª©ì†Œë¦¬ì˜ ë¹„ê²°",
				},
				{
					name: "í˜„ìˆœì£¼ ì§‘ì‚¬",
					topic: "ë°ì€ë¯¸ì†Œ",
					question: "ë°ì€ ë¯¸ì†Œ, ì¢‹ì€ ì¸ì„±ì˜ ë¹„ê²°",
				},
			];

			let currentIndex = 0;
			let isShuffling = false;
			let isPicking = false;
			let pickCount = 0;
			const maxPicks = 5;

			// í˜ì´ì§€ ë¡œë“œ ì‹œ ì œë¹„ ìƒì„±
			window.onload = function () {
				createPapers();
				showTopicPreview();
				updatePickCount();
				
				// Service Worker ë“±ë¡
				if ('serviceWorker' in navigator) {
					navigator.serviceWorker.register('sw.js')
						.then(reg => console.log('Service Worker ë“±ë¡ ì„±ê³µ'))
						.catch(err => console.log('Service Worker ë“±ë¡ ì‹¤íŒ¨:', err));
				}
				
				// ëª¨ë°”ì¼ í„°ì¹˜ ì´ë²¤íŠ¸ ìµœì í™”
				document.addEventListener('touchstart', function() {}, {passive: true});
			};

			// ë‚¨ì€ ë½‘ê¸° íšŸìˆ˜ ì—…ë°ì´íŠ¸
			function updatePickCount() {
				const remaining = maxPicks - pickCount;
				document.getElementById(
					"pickCount"
				).textContent = `ë‚¨ì€ ë½‘ê¸°: ${remaining}/${maxPicks}`;

				// 5ë²ˆ ë‹¤ ë½‘ìœ¼ë©´ ë½‘ê¸° ë²„íŠ¼ ë¹„í™œì„±í™”
				if (remaining === 0) {
					document.getElementById("pickBtn").disabled = true;
					document.getElementById("pickBtn").textContent = "ğŸ¯ ì™„ë£Œ";
				}
			}

			// ì£¼ì œ ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
			function showTopicPreview() {
				const rightSection = document.getElementById("rightSection");
				const topicPreview = document.getElementById("topicPreview");
				const result = document.getElementById("result");

				rightSection.classList.add("show");
				topicPreview.style.display = "block";
				result.style.display = "none";
			}

			// ì œë¹„ ìƒì„±
			function createPapers() {
				const papersContainer = document.getElementById("papers");
				papersContainer.innerHTML = "";

				// 15ê°œì˜ ì œë¹„ ìƒì„± (ì‹¤ì œë¡œëŠ” 5ëª…ë§Œ ì„ íƒë¨)
				for (let i = 0; i < 15; i++) {
					const paper = document.createElement("div");
					paper.className = "paper";
					paper.style.transform = `rotate(${Math.random() * 20 - 10}deg)`;
					papersContainer.appendChild(paper);
				}
			}

			// ë²„íŠ¼ í„°ì¹˜ í”¼ë“œë°±
			function addTouchFeedback(button) {
				button.addEventListener('touchstart', function() {
					this.style.transform = 'scale(0.95)';
				}, {passive: true});
				
				button.addEventListener('touchend', function() {
					this.style.transform = '';
				}, {passive: true});
			}
			
			// ëª¨ë“  ë²„íŠ¼ì— í„°ì¹˜ í”¼ë“œë°± ì¶”ê°€
			document.querySelectorAll('button').forEach(addTouchFeedback);
			
			// ì„ê¸° íš¨ê³¼
			function shufflePapers() {
				if (isShuffling || isPicking) return;
				
				// ëª¨ë°”ì¼ì—ì„œ ì§„ë™ í”¼ë“œë°±
				if (navigator.vibrate) {
					navigator.vibrate(50);
				}

				isShuffling = true;
				const papers = document.querySelectorAll(".paper");
				const shuffleBtn = document.getElementById("shuffleBtn");
				const lotteryBox = document.querySelector(".lottery-box");

				shuffleBtn.disabled = true;

				// ì£¼ì œ ë¯¸ë¦¬ë³´ê¸°ë¡œ ì „í™˜
				showTopicPreview();

				// ë°•ìŠ¤ í”ë“¤ê¸° íš¨ê³¼
				lotteryBox.classList.add("shaking");

				// ì„ê¸° ì• ë‹ˆë©”ì´ì…˜ - ë” ì—­ë™ì ìœ¼ë¡œ
				papers.forEach((paper, index) => {
					setTimeout(() => {
						paper.classList.add("shuffle");

						// ë” í° ë²”ìœ„ì˜ ëœë¤ ì›€ì§ì„
						const randomX = (Math.random() - 0.5) * 300;
						const randomY = (Math.random() - 0.5) * 300;
						const randomRotate = Math.random() * 720 - 360;

						paper.style.transition = "all 0.8s cubic-bezier(0.4, 0.0, 0.2, 1)";
						paper.style.transform = `translate(${randomX}px, ${randomY}px) rotate(${randomRotate}deg) scale(${
							Math.random() * 0.5 + 0.8
						})`;

						// ì¤‘ê°„ì— í•œë²ˆ ë” ìœ„ì¹˜ ë³€ê²½
						setTimeout(() => {
							const newX = (Math.random() - 0.5) * 150;
							const newY = (Math.random() - 0.5) * 150;
							paper.style.transform = `translate(${newX}px, ${newY}px) rotate(${
								Math.random() * 360
							}deg)`;
						}, 400);
					}, index * 50);
				});

				// ì• ë‹ˆë©”ì´ì…˜ ì¢…ë£Œ í›„
				setTimeout(() => {
					papers.forEach((paper, index) => {
						paper.classList.remove("shuffle");
						paper.style.transition = "all 0.5s ease-out";
						paper.style.transform = `rotate(${Math.random() * 20 - 10}deg)`;

						// ìˆœì°¨ì ìœ¼ë¡œ ì›ìœ„ì¹˜
						setTimeout(() => {
							paper.style.transition = "transform 0.3s ease";
						}, index * 30);
					});

					lotteryBox.classList.remove("shaking");
					shuffleBtn.disabled = false;
					isShuffling = false;
				}, 2500);
			}

			// ë½‘ê¸°
			function pickPaper() {
				if (isPicking || isShuffling || pickCount >= maxPicks) return;
				
				// ëª¨ë°”ì¼ì—ì„œ ì§„ë™ í”¼ë“œë°±
				if (navigator.vibrate) {
					navigator.vibrate([50, 100, 50]);
				}

				isPicking = true;
				const pickBtn = document.getElementById("pickBtn");
				const hand = document.getElementById("hand");
				const selectedPaper = document.getElementById("selectedPaper");
				const result = document.getElementById("result");
				const topicPreview = document.getElementById("topicPreview");
				const topicItems = document.querySelectorAll(".topic-item");

				pickBtn.disabled = true;

				// ì† ì• ë‹ˆë©”ì´ì…˜
				hand.classList.add("picking");

				// 1ì´ˆ í›„ ê²°ê³¼ í‘œì‹œ
				setTimeout(() => {
					// ë¯¸ë¦¬ ì •í•´ì§„ ìˆœì„œëŒ€ë¡œ ì„ íƒ
					const selected = presetData[currentIndex];

					// ì£¼ì œ ê°•ì¡° íš¨ê³¼
					topicItems.forEach((item, idx) => {
						item.classList.remove("active");
						if (idx === currentIndex) {
							item.classList.add("active");
						}
					});

					currentIndex = (currentIndex + 1) % presetData.length;
					pickCount++;
					updatePickCount();

					// ì„ íƒëœ ì¢…ì´ í‘œì‹œ
					selectedPaper.classList.add("show");

					// ê²°ê³¼ í‘œì‹œ
					setTimeout(() => {
						result.querySelector(".person").textContent = selected.name;
						result.querySelector(".question").textContent = selected.question;

						topicPreview.style.display = "none";
						result.style.display = "block";

						// ìƒ‰ì¢…ì´ íš¨ê³¼ (ëª¨ë°”ì¼ì—ì„œëŠ” ê°œìˆ˜ ì¤„ì´ê¸°)
						const isMobile = window.innerWidth <= 768;
						createConfetti(isMobile ? 30 : 50);

						// ì´ˆê¸°í™”
						setTimeout(() => {
							hand.classList.remove("picking");
							selectedPaper.classList.remove("show");
							if (pickCount < maxPicks) {
								pickBtn.disabled = false;
							}
							isPicking = false;
						}, 1000);
					}, 500);
				}, 1000);
			}

			// ìƒ‰ì¢…ì´ íš¨ê³¼
			function createConfetti(count = 50) {
				const colors = [
					"#ff6b6b",
					"#4ecdc4",
					"#45b7d1",
					"#f7b731",
					"#5f27cd",
					"#00d2d3",
				];

				for (let i = 0; i < count; i++) {
					setTimeout(() => {
						const confetti = document.createElement("div");
						confetti.className = "confetti";
						confetti.style.cssText = `
							position: fixed;
							width: 10px;
							height: 10px;
							top: -10px;
							left: ${Math.random() * 100}%;
							background-color: ${colors[Math.floor(Math.random() * colors.length)]};
							animation: fall ${Math.random() * 2 + 3}s linear;
							pointer-events: none;
						`;
						document.body.appendChild(confetti);

						setTimeout(() => confetti.remove(), 3000);
					}, i * 30);
				}
			}
		</script>
	</body>
</html>
